<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev's Matrix Vision</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; }
        
        #canvas { 
            display: block; 
            width: 100vw; height: 100vh; 
            transform: scaleX(-1); /* મિરર ઈફેક્ટ */
        }
        
        #video { display: none; }
        
        #ui {
            position: absolute; top: 10px; left: 10px;
            color: #0F0; font-size: 12px;
            background: rgba(0, 20, 0, 0.8);
            padding: 10px; border: 1px solid #0F0;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="ui">
        SYSTEM: MATRIX CORE<br>
        RESOLUTION: HIGH<br>
        MODE: ASCII RENDER
    </div>

    <video id="video" playsinline></video>
    <canvas id="canvas"></canvas>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // કેરેક્ટર્સ: ઘાટા થી આછા (Dark to Light)
        // આ સ્ટ્રિંગ નક્કી કરે છે કે કયા પિક્સેલ માટે કયો અક્ષર વાપરવો
        const density = "Ñ@#W$9876543210?!abc;:+=-,._ ";
        // const density = "SIMPLE_TEXT_ "; // તમે આ બદલી શકો

        async function setupCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { width: 640, height: 480 },
                audio: false
            });
            video.srcObject = stream;
            await video.play();
        }

        function render() {
            // કેન્વાસને વિડીયોની સાઈઝ આપો
            const w = canvas.width = window.innerWidth;
            const h = canvas.height = window.innerHeight;
            
            // આપણે પરફોર્મન્સ માટે નાનું ડ્રોઈંગ બનાવીશું અને તેને ટેક્સ્ટમાં ફેરવીશું
            // ગણતરી: સ્ક્રીન પર કેટલા અક્ષરો સમાશે?
            const fontSize = 12;
            const cols = Math.floor(w / fontSize);
            const rows = Math.floor(h / fontSize);

            // 1. મેમરીમાં એક નાની ઈમેજ દોરો (Hidden Processing)
            const hiddenCanvas = document.createElement('canvas');
            hiddenCanvas.width = cols;
            hiddenCanvas.height = rows;
            const hiddenCtx = hiddenCanvas.getContext('2d');
            
            // વિડીયોને નાનો કરીને ડ્રો કરો (Downsampling)
            hiddenCtx.drawImage(video, 0, 0, cols, rows);
            
            // 2. પિક્સેલ ડેટા વાંચો
            const frame = hiddenCtx.getImageData(0, 0, cols, rows);
            const data = frame.data;

            // 3. મુખ્ય કેન્વાસ પર ટેક્સ્ટ લખો
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, w, h); // સ્ક્રીન સાફ કરો

            ctx.fillStyle = "#0F0"; // Matrix Green Color
            ctx.font = fontSize + "px monospace";

            // દરેક પિક્સેલ માટે લૂપ ફેરવો
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // તેજસ્વીતા (Brightness) શોધો
                const avg = (r + g + b) / 3;
                
                // Brightness (0-255) ને Character String (0-length) સાથે મેપ કરો
                const len = density.length;
                const charIndex = Math.floor((avg / 255) * len);
                
                const char = density.charAt(charIndex);

                // ટેક્સ્ટની પોઝિશન શોધો
                // i/4 કારણ કે ડેટા એરેમાં 4 વેલ્યુ (RGBA) હોય છે
                const pixelIndex = i / 4;
                const x = (pixelIndex % cols) * fontSize;
                const y = Math.floor(pixelIndex / cols) * fontSize;

                ctx.fillText(char, x, y);
            }

            requestAnimationFrame(render);
        }

        setupCamera().then(() => {
            render();
        });

    </script>
</body>
</html>
