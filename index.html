<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev's Smart Reader Pro</title>
    <style>
        body { margin: 0; background: #fdf6e3; color: #333; font-family: 'Georgia', serif; line-height: 1.8; padding-bottom: 50vh; }
        
        /* સેટિંગ પેનલ */
        #control-panel {
            position: fixed; top: 0; left: 0; width: 100%; 
            background: rgba(0, 0, 0, 0.9); color: #0f0; 
            padding: 10px; z-index: 2000; font-family: monospace; font-size: 12px;
            display: flex; flex-direction: column; gap: 5px;
        }

        .row { display: flex; justify-content: space-between; align-items: center; }
        button { padding: 5px 10px; background: #333; color: white; border: 1px solid #555; }
        
        /* વિઝ્યુઅલ બાર */
        #bar-container { width: 100%; height: 10px; background: #333; margin-top: 5px; position: relative; }
        #nose-marker { width: 4px; height: 100%; background: #0f0; position: absolute; left: 50%; transition: left 0.1s; }
        #zone-neutral { position: absolute; left: 40%; width: 20%; height: 100%; background: rgba(255, 255, 255, 0.2); }

        .content { margin-top: 120px; padding: 20px; }
        .verse { background: #fff; padding: 20px; margin-bottom: 20px; border-left: 5px solid #b58900; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .verse-title { font-weight: bold; color: #b58900; }
        
        #cam-preview { position: fixed; bottom: 0; right: 0; width: 80px; opacity: 0.5; pointer-events: none; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
</head>
<body>

    <div id="control-panel">
        <div class="row">
            <span>STATUS: <b id="status-text">WAITING...</b></span>
            <span>Y: <b id="y-val">0.00</b></span>
        </div>
        <div class="row">
            <label><input type="checkbox" id="invert-check"> ઊંધું કરો (Reverse)</label>
            <button onclick="window.scrollTo(0,0)">Top</button>
        </div>
        <div id="bar-container">
            <div id="zone-neutral"></div>
            <div id="nose-marker"></div>
        </div>
    </div>

    <video id="cam-preview" playsinline></video>

    <div class="content">
        <h2 style="text-align:center;">શ્રીમદ ભગવદ ગીતા (Calibration Mode)</h2>
        <p style="text-align:center; color: #666; font-size: 0.9em;">
            ઉપરની લીલી લીટી જુઓ.<br>
            વચ્ચેના બોક્સમાં હોય તો સ્ક્રોલ બંધ રહેશે.<br>
            બોક્સની બહાર જાય તો સ્ક્રોલ થશે.
        </p>

        <div class="verse"><div class="verse-title">શ્લોક ૧</div><p>ધૃતરાષ્ટ્ર ઉવાચ | ધર્મક્ષેત્રે કુરુક્ષેત્રે સમવેતા યુયુત્સવઃ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૨</div><p>સઞ્જય ઉવાચ | દૃષ્ટ્વા તુ પાણ્ડવાનીકં વ્યૂઢં દુર્યોધનસ્તદા |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૩</div><p>પશ્યૈતાં પાણ્ડુપુત્રાણામાચાર્ય મહતીં ચમૂમ્ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૪</div><p>અત્ર શૂરા મહેષ્વાસા ભીમાર્જુનસમા યુધિ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૫</div><p>ધૃષ્ટકેતુશ્ચેકિતાનઃ કાશીરાજશ્ચ વીર્યવાન્ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૬</div><p>યુધામન્યુશ્ચ વિક્રાન્ત ઉત્તમૌજાશ્ચ વીર્યવાન્ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૭</div><p>અસ્માકં તુ વિશિષ્ટા યે તાન્નિબોધ દ્વિજોત્તમ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૮</div><p>ભવાનભીષ્મશ્ચ કર્ણશ્ચ કૃપશ્ચ સમિતિઞ્જયઃ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૯</div><p>અન્યે ચ બહવઃ શૂરા મદર્થે ત્યક્તજીવિતાઃ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૧૦</div><p>અપર્યાપ્તં તદસ્માકં બલં ભીષ્માભિરક્ષિતમ્ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૧૧</div><p>અયનેષુ ચ સર્વેષુ યથાભાગમવસ્થિતાઃ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૧૨</div><p>તસ્ય સઞ્જનયન્હર્ષં કુરુવૃદ્ધઃ પિતામહઃ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૧૩</div><p>તતઃ શઙ્ખાશ્ચ ભેર્યશ્ચ પણવાનકગોમુખાઃ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૧૪</div><p>તતઃ શ્વેતૈર્હયૈર્યુક્તે મહતિ સ્યન્દને સ્થિતૌ |</p></div>
        <div class="verse"><div class="verse-title">શ્લોક ૧૫</div><p>પાઞ્ચજન્યં હૃષીકેશો દેવદત્તં ધનઞ્જયઃ |</p></div>
    </div>

    <script>
        const videoElement = document.getElementById('cam-preview');
        const statusText = document.getElementById('status-text');
        const yValText = document.getElementById('y-val');
        const noseMarker = document.getElementById('nose-marker');
        const invertCheck = document.getElementById('invert-check');

        function onResults(results) {
            if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
                const landmarks = results.multiFaceLandmarks[0];
                const noseTip = landmarks[1];
                let y = noseTip.y; // 0 (Top) to 1 (Bottom)

                // Update Debug UI
                yValText.innerText = y.toFixed(2);
                noseMarker.style.left = (y * 100) + "%";

                let speed = 10;
                let scrollAmount = 0;

                // Logic: Center area is 0.40 to 0.60
                if (y > 0.60) { 
                    statusText.innerText = "DOWN ▼";
                    statusText.style.color = "cyan";
                    scrollAmount = speed; // Default Scroll Down
                } 
                else if (y < 0.40) { 
                    statusText.innerText = "UP ▲";
                    statusText.style.color = "orange";
                    scrollAmount = -speed; // Default Scroll Up
                } 
                else {
                    statusText.innerText = "NEUTRAL";
                    statusText.style.color = "lime";
                    scrollAmount = 0;
                }

                // If Invert checkbox is checked, flip the direction
                if (invertCheck.checked) {
                    scrollAmount = -scrollAmount;
                }

                if (scrollAmount !== 0) {
                    window.scrollBy({ top: scrollAmount, behavior: 'smooth' });
                }

            } else {
                statusText.innerText = "NO FACE";
                statusText.style.color = "red";
            }
        }

        const faceMesh = new FaceMesh({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`});
        
        faceMesh.setOptions({
            maxNumFaces: 1,
            refineLandmarks: false,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        faceMesh.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => await faceMesh.send({image: videoElement}),
            width: 320, height: 240
        });
        camera.start();
    </script>
</body>
</html>
