<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev's Time Warp</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        
        #container { position: relative; width: 100vw; height: 100vh; }
        
        /* લાઈવ કેમેરા (પાછળ રહેશે) */
        #video {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
        }

        /* જાદુઈ કેન્વાસ (પરિણામ) */
        #canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
        }

        /* સ્કેનિંગ લાઈન */
        #scan-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: #00d2ff;
            box-shadow: 0 0 10px #00d2ff;
            z-index: 10;
        }

        #msg {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: white; font-size: 14px; text-shadow: 0 2px 4px black;
            z-index: 20; pointer-events: none;
        }

        #btn {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
            padding: 15px 30px; background: #00d2ff; border: none; border-radius: 30px;
            font-size: 18px; font-weight: bold; cursor: pointer; z-index: 20;
        }
    </style>
</head>
<body>

    <div id="container">
        <video id="video" playsinline muted></video>
        <canvas id="canvas"></canvas>
        <div id="scan-line"></div>
        
        <div id="msg">પરિણામ જોવા માટે રાહ જુઓ...</div>
        <button id="btn">START SCAN</button>
    </div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const scanLine = document.getElementById('scan-line');
        const btn = document.getElementById('btn');

        let isScanning = false;
        let scanY = 0; // સ્કેનિંગ લાઈનની પોઝિશન
        let speed = 2; // સ્કેનિંગ સ્પીડ

        async function setupCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'user', width: 1280, height: 720 }, // Front camera
                audio: false
            });
            video.srcObject = stream;
            await video.play();

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        btn.addEventListener('click', () => {
            if (isScanning) return;
            
            // રીસેટ કરો
            isScanning = true;
            scanY = 0;
            btn.style.display = 'none';
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            scanLoop();
        });

        function scanLoop() {
            if (!isScanning) return;

            // કેન્વાસ અને વિડીયોનું મેપિંગ (Aspect Ratio સાચવવા)
            const vRatio = video.videoWidth / video.videoHeight;
            const cRatio = canvas.width / canvas.height;
            let sWidth, sHeight, sx, sy;

            if (cRatio > vRatio) {
                sWidth = video.videoWidth;
                sHeight = video.videoWidth / cRatio;
                sx = 0;
                sy = (video.videoHeight - sHeight) / 2;
            } else {
                sWidth = video.videoHeight * cRatio;
                sHeight = video.videoHeight;
                sx = (video.videoWidth - sWidth) / 2;
                sy = 0;
            }

            // ગણિત: લાઈવ વિડીયોમાંથી માત્ર 1 પિક્સેલની પટ્ટી કાપો
            // અને તેને કેન્વાસ પર "scanY" પોઝિશન પર ચોંટાડો
            
            // Source (Video)
            // Destination (Canvas)
            
            // આપણે વિડીયોના સેન્ટર પાર્ટમાંથી ડેટા લઈએ છીએ
            // આ લાઈન બહુ મહત્વની છે: આપણે વિડીયોની 'વચ્ચેની' લાઈન નથી લેતા, 
            // પણ સ્કેનર જ્યાં પહોંચ્યું છે તે લાઈન લઈએ છીએ.
            
            // વિડીયો યામમાં કન્વર્ટ કરો
            const videoScanY = sy + (scanY / canvas.height) * sHeight;

            ctx.drawImage(
                video, 
                sx, videoScanY, sWidth, speed, // Source Rect
                0, scanY, canvas.width, speed // Dest Rect
            );

            // લાઈન ખસેડો
            scanY += speed;
            scanLine.style.top = scanY + 'px';

            if (scanY < canvas.height) {
                requestAnimationFrame(scanLoop);
            } else {
                isScanning = false;
                btn.style.display = 'block';
                btn.innerText = "AGAIN";
                scanLine.style.display = 'none';
            }
        }

        setupCamera();

    </script>
</body>
</html>
