<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev's Divine Yantra</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        
        #container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        
        canvas { 
            /* ગોળ આકારમાં યંત્ર દેખાશે */
            border-radius: 50%; 
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
            max-width: 100%; max-height: 100%;
        }

        #video { display: none; }

        .controls {
            position: absolute; bottom: 30px; width: 100%; text-align: center;
            z-index: 10;
        }

        input[type=range] { width: 60%; accent-color: gold; }
        
        h2 {
            position: absolute; top: 10px; width: 100%; text-align: center;
            color: gold; text-transform: uppercase; letter-spacing: 5px;
            font-size: 14px; text-shadow: 0 0 10px gold; pointer-events: none;
        }
    </style>
</head>
<body>

    <h2>The Living Yantra</h2>

    <div id="container">
        <video id="video" playsinline autoplay muted></video>
        <canvas id="canvas"></canvas>
    </div>

    <div class="controls">
        <div style="color: gold; margin-bottom: 5px;">SYMMETRY: <span id="sym-val">8</span></div>
        <input type="range" id="slider" min="4" max="24" step="2" value="8">
    </div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const slider = document.getElementById('slider');
        const symVal = document.getElementById('sym-val');

        let symmetry = 8; // કેટલા ભાગમાં વહેંચવું

        slider.addEventListener('input', (e) => {
            symmetry = parseInt(e.target.value);
            symVal.innerText = symmetry;
        });

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' },
                    audio: false
                });
                video.srcObject = stream;
                video.play();
                draw();
            } catch (err) {
                alert("Camera access needed for the magic!");
            }
        }

        function draw() {
            // કેન્વાસને વિન્ડો સાઈઝનું રાખો
            const size = Math.min(window.innerWidth, window.innerHeight);
            canvas.width = size;
            canvas.height = size;
            
            const w = canvas.width;
            const h = canvas.height;
            const cx = w / 2;
            const cy = h / 2;
            
            // યંત્રનું ગણિત (Kaleidoscope Logic)
            const angle = (Math.PI * 2) / symmetry;

            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, w, h);
            
            ctx.save();
            ctx.translate(cx, cy);

            for (let i = 0; i < symmetry; i++) {
                ctx.save();
                ctx.rotate(i * angle);

                // મિરર ઈફેક્ટ (એક સીધું, એક ઊંધું - જેથી પેટર્ન જોડાય)
                if (i % 2 !== 0) {
                    ctx.scale(1, -1);
                }

                // ક્લિપિંગ (ત્રિકોણ કાપવો)
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, cx, -angle / 2 - 0.01, angle / 2 + 0.01); // સહેજ ઓવરલેપ જેથી લાઈન ન દેખાય
                ctx.closePath();
                ctx.clip();

                // વિડીયો ડ્રો કરો
                // અહીં આપણે વિડીયોનો થોડો જ ભાગ લઈએ છીએ અને તેને ફેરવીએ છીએ
                const videoSize = Math.min(video.videoWidth, video.videoHeight);
                const sx = (video.videoWidth - videoSize) / 2;
                const sy = (video.videoHeight - videoSize) / 2;
                
                // રોટેશન એડજસ્ટમેન્ટ જેથી ઈમેજ સીધી લાગે
                ctx.rotate(Math.PI / 2); 
                
                // ડ્રો કરો
                ctx.drawImage(video, sx, sy, videoSize, videoSize, -cx, -cx, w, w);
                
                ctx.restore();
            }
            ctx.restore();

            // ગોલ્ડન રિંગ બોર્ડર
            ctx.beginPath();
            ctx.arc(cx, cy, cx - 5, 0, Math.PI * 2);
            ctx.lineWidth = 10;
            ctx.strokeStyle = '#DAA520'; // GoldenRod
            ctx.stroke();

            requestAnimationFrame(draw);
        }

        startCamera();
    </script>
</body>
</html>
